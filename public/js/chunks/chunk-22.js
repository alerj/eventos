(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{M9Qw:function(e,t,o){"use strict";o.r(t);var r=o("jx1L"),n=o("WPQR"),a=o("CtO9"),i=o("L2JU");function s(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function c(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var l={name:"people",uri:"people",performLoad:!1},u={props:["mode"],mixins:[r.a,n.a,a.a],data:function(){return{service:l,photo:null,photoUrl:"https://dummyimage.com/200x200/fff/aaa",photoBlob:null,showCropper:!1,currentNameIsDuplicate:!1}},methods:function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?s(o,!0).forEach((function(t){c(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):s(o).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({},Object(i.mapActions)(l.name,["selectPerson"]),{generatePhoto:function(){var e=this;this.mutatePhotoUrl(this.photo.generateDataUrl()),this.photo.generateBlob((function(t){e.mutatePhoto(t)}),"image/jpeg",.85)},usePhoto:function(){this.generatePhoto(),this.showCropper=!1},mutatePhoto:function(e){var t=this;blob_to_base64(e,(function(o){t.mutateSetFormField({field:"photo",value:e.type+";"+o})}))},mutatePhotoUrl:function(e){this.mutateSetFormField({field:"photoUrl",value:e})},flushImageCache:function(e){return flush_image_cache(e)},verifyDuplicateName:function(e){var t=this;clearTimeout(this.timeout),this.currentNameIsDuplicate=!1,this.timeout=setTimeout((function(){post("/api/v1/people/validate-name",{name:e}).catch((function(e){t.currentNameIsDuplicate=!0}))}),500)},getNameDuplicateMessage:function(){return this.currentNameIsDuplicate?"Foi encontrado uma pessoa com este mesmo nome. Recomenda-se verificar as pessoas cadastradas.":""},confirmNameDuplicate:function(){var e=this;confirm("Deseja realmente cadastrar novamente o nome: "+this.form.fields.name+"?",this).then((function(t){t&&e.saveModel()}))},savePerson:function(){this.currentNameIsDuplicate?this.confirmNameDuplicate():this.saveModel()}}),computed:{photoUrlField:function(){return flush_image_cache(this.form.fields.photoUrl)}}},p=o("KHd+"),f=Object(p.a)(u,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("div",{staticClass:"py-2 text-center"},[o("h2",[e._v(e._s("create"===this.mode?"Nova ":"Editar")+" Pessoa")]),e._v(" "),o("h2",[e._v(e._s(e.form.fields.name?e.form.fields.name:""))])]),e._v(" "),o("div",{staticClass:"row justify-content-center"},[o("div",{staticClass:"col-8"},[o("form",[o("div",{staticClass:"row"},[o("div",{staticClass:"col-12"},[o("img",{staticClass:"img-thumbnail rounded mx-auto d-block",attrs:{src:e.makePhotoUrl(),width:"200",height:"200"},on:{click:function(t){e.showCropper=!0}}}),e._v(" "),o("b-modal",{attrs:{id:"croppaModal","body-class":"mx-auto",centered:""},model:{value:e.showCropper,callback:function(t){e.showCropper=t},expression:"showCropper"}},[o("vue-croppa",{attrs:{placeholder:"Selecione uma imagem",width:400,height:400,"prevent-white-space":!0},model:{value:e.photo,callback:function(t){e.photo=t},expression:"photo"}}),e._v(" "),o("div",{staticClass:"w-100",attrs:{slot:"modal-footer"},slot:"modal-footer"},[o("div",{staticClass:"float-right btn btn-success",on:{click:function(t){e.showCropper=!1}}},[e._v("\n                                    Cancelar\n                                ")]),e._v(" "),o("div",{staticClass:"float-right btn btn-outline-secondary mr-2",on:{click:function(t){return e.usePhoto()}}},[e._v("\n                                    OK\n                                ")])])],1)],1)]),e._v(" "),o("div",{staticClass:"row"},[o("div",{staticClass:"col-12 mb-3"},[o("app-input",{attrs:{name:"name",label:"Nome",required:!0,form:e.form,"additional-error-message":e.getNameDuplicateMessage(),dusk:"people-name"},on:{"on-key-up":function(t){return e.verifyDuplicateName(e.form.fields.name)}},model:{value:e.form.fields.name,callback:function(t){e.$set(e.form.fields,"name",t)},expression:"form.fields.name"}}),e._v(" "),o("app-input",{directives:[{name:"mask",rawName:"v-mask",value:"###.###.###-##",expression:"'###.###.###-##'"}],attrs:{name:"cpf",label:"CPF",required:!1,form:e.form},model:{value:e.form.fields.cpf,callback:function(t){e.$set(e.form.fields,"cpf",t)},expression:"form.fields.cpf"}}),e._v(" "),o("app-input",{attrs:{name:"nickname",label:"Nome público",required:!0,form:e.form},model:{value:e.form.fields.nickname,callback:function(t){e.$set(e.form.fields,"nickname",t)},expression:"form.fields.nickname"}}),e._v(" "),o("app-input",{attrs:{name:"title",label:"Tratamento",required:!0,form:e.form,dusk:"title"},model:{value:e.form.fields.title,callback:function(t){e.$set(e.form.fields,"title",t)},expression:"form.fields.title"}}),e._v(" "),o("app-input",{attrs:{name:"birthdate",label:"Data de nascimento",type:"date",form:e.form},model:{value:e.form.fields.birthdate,callback:function(t){e.$set(e.form.fields,"birthdate",t)},expression:"form.fields.birthdate"}}),e._v(" "),o("app-textarea",{attrs:{label:"Observações",name:"notes",form:e.form,rows:15},model:{value:e.form.fields.notes,callback:function(t){e.$set(e.form.fields,"notes",t)},expression:"form.fields.notes"}}),e._v(" "),o("app-input",{attrs:{name:"is_active",label:"Ativo",type:"checkbox",required:!0,form:e.form,dusk:"active-dusk"},model:{value:e.form.fields.is_active,callback:function(t){e.$set(e.form.fields,"is_active",t)},expression:"form.fields.is_active"}})],1)]),e._v(" "),o("div",{staticClass:"row"},[o("div",{staticClass:"col-12 text-right mb-3"},[o("button",{staticClass:"btn btn-outline-secondary",attrs:{type:"submit",dusk:"record-people-button",disabled:e.cannot("people:modify")},on:{click:function(t){return t.preventDefault(),e.savePerson()}}},[e._v("\n                            gravar\n                        ")]),e._v(" "),o("router-link",{staticClass:"btn btn-success",attrs:{to:"/people",tag:"button"}},[e._v("\n                            cancelar\n                        ")])],1)])])])])])}),[],!1,null,null,null);t.default=f.exports},WPQR:function(e,t,o){"use strict";var r=o("L2JU");function n(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(o,!0).forEach((function(t){i(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(o).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function i(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}t.a={data:function(){return{people_current:{id:"null"}}},methods:a({},Object(r.mapActions)("people",["clearForm"]),{makePhotoUrl:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e||(e=this.people.form.fields.photoUrl),e||(e=this.people.selected.photoUrl);var t=this.people_current.id!=this.people.selected.id;return this.people_current.id=this.people.selected.id,flush_image_cache(e,t)}}),computed:a({},Object(r.mapState)({people:function(e){return e.people},personInstitutions:function(e){return e.personInstitutions},contacts:function(e){return e.contacts},addresses:function(e){return e.addresses},personCategories:function(e){return e.personCategories},personTopics:function(e){return e.personTopics},advisors:function(e){return e.advisors},advisorContacts:function(e){return e.advisorContacts}}))}}}]);